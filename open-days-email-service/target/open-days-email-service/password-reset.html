<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Password Reset</title>
    <link rel="stylesheet" href="password-reset.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <script language="JavaScript">
        function isEmpty(str) {
            return (!str || 0 === str.trim().length);
        }

        function changePassword() {
            var urlParams = new URLSearchParams(location.search);

            if (!urlParams.has('token') || isEmpty(urlParams.get('token'))) {
                alert("Missing the required Token");
                return;
            }

            var tokenValue = urlParams.get('token');
            var password_new = document.getElementById("password_new").value;
            var password_confirmation = document.getElementById("password_confirmation").value;

            if (isEmpty(password_new)) {
                alert("Password cannot be empty");
                return;
            }

            if (password_new !== password_confirmation) {
                    alert("Passwords do not match");
                    return;
            }

            $.ajaxSetup({
                "contentType": "application/json"
            });

            var dataPayload = { "token": tokenValue, "password": password_new };

            $.post('http://localhost:8080/open-days/users/password-reset', JSON.stringify(dataPayload))
                .done(function (response) {
                    document.getElementById("password_new").value="";
                    document.getElementById("password_confirmation").value="";

                    if ($(response).attr("operationResult") === "SUCCESS") {
                        $("#negative_feedback").attr("style", "display: none !important;");
                        $("#positive_feedback").attr("style", "display: block !important;");
                    } else {
                        $("#positive_feedback").attr("style", "display: none !important;");
                        $("#negative_feedback").attr("style", "display: block !important;");
                    }
                });
        }

        function test() {
            $("#negative_feedback").attr("style", "display: block !important;");
        }
    </script>
</head>
<body>

<div class="container">
    <div class="title">Set you new password here</div>
    <form action="#" id="password-reset-form">
        <div class="password-holder">
            <div class="user-input">
                <span class="user-input-label">New Password</span><br>
                <input type="password" id="password_new" required/>
            </div>
            <div class="user-input">
                <span class="user-input-label">Confirm New Password</span><br>
                <input type="password" id="password_confirmation" required/>
            </div>
        </div>
        <div class="button-holder">
            <input type="button" value="Save" onclick="javascript:changePassword()"/>
        </div>
        <div class="feedback-holder">
            <div id="positive_feedback" style="display:none">Password updated successfully</div>
            <div id="negative_feedback" style="display:none">Couldn't update password</div>
        </div>
    </form>
</div>
</body>
</html>